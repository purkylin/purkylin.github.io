<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>macosé€†å‘ç¬”è®° | Purkylin&#39;s Blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="åŸºç¡€
é‡æ–°ç­¾åcodesign --deep -f -s &amp;quot;Mac Developer: purkylin@gmail.com (K2WB492RBL)&amp;quot; &amp;lt;App&amp;gt;
æŸ¥çœ‹ç­¾åcodesign -d --verbose=3 &amp;lt;App&amp;gt;
æŸ¥çœ‹dylibåç§»image list -o
ä¸­æ–‡å­—ç¬¦ä¸²æŸ¥æ‰¾åœ¨å­—ç¬¦ä¸²èµ„æºæ–‡ä»¶é‡ŒæŸ¥æ‰¾å¯¹åº”çš„è‹±æ–‡æ¡ç›®ï¼Œç„¶åæ”¾åˆ°hopperé‡Œ">
<meta property="og:type" content="article">
<meta property="og:title" content="macosé€†å‘ç¬”è®°">
<meta property="og:url" content="http://purkylin.github.io/2017/02/22/macosé€†å‘ç¬”è®°/index.html">
<meta property="og:site_name" content="Purkylin's Blog">
<meta property="og:description" content="åŸºç¡€
é‡æ–°ç­¾åcodesign --deep -f -s &amp;quot;Mac Developer: purkylin@gmail.com (K2WB492RBL)&amp;quot; &amp;lt;App&amp;gt;
æŸ¥çœ‹ç­¾åcodesign -d --verbose=3 &amp;lt;App&amp;gt;
æŸ¥çœ‹dylibåç§»image list -o
ä¸­æ–‡å­—ç¬¦ä¸²æŸ¥æ‰¾åœ¨å­—ç¬¦ä¸²èµ„æºæ–‡ä»¶é‡ŒæŸ¥æ‰¾å¯¹åº”çš„è‹±æ–‡æ¡ç›®ï¼Œç„¶åæ”¾åˆ°hopperé‡Œ">
<meta property="og:updated_time" content="2017-02-22T03:56:54.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="macosé€†å‘ç¬”è®°">
<meta name="twitter:description" content="åŸºç¡€
é‡æ–°ç­¾åcodesign --deep -f -s &amp;quot;Mac Developer: purkylin@gmail.com (K2WB492RBL)&amp;quot; &amp;lt;App&amp;gt;
æŸ¥çœ‹ç­¾åcodesign -d --verbose=3 &amp;lt;App&amp;gt;
æŸ¥çœ‹dylibåç§»image list -o
ä¸­æ–‡å­—ç¬¦ä¸²æŸ¥æ‰¾åœ¨å­—ç¬¦ä¸²èµ„æºæ–‡ä»¶é‡ŒæŸ¥æ‰¾å¯¹åº”çš„è‹±æ–‡æ¡ç›®ï¼Œç„¶åæ”¾åˆ°hopperé‡Œ">
  
    <link rel="alternate" href="/atom.xml" title="Purkylin&#39;s Blog" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css" type="text/css">
  

</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Purkylin&#39;s Blog</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="æœç´¢"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://purkylin.github.io"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-macosé€†å‘ç¬”è®°" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/02/22/macosé€†å‘ç¬”è®°/" class="article-date">
  <time datetime="2017-02-22T03:53:00.000Z" itemprop="datePublished">2017-02-22</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      macosé€†å‘ç¬”è®°
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="åŸºç¡€"><a href="#åŸºç¡€" class="headerlink" title="åŸºç¡€"></a>åŸºç¡€</h2><ul>
<li>é‡æ–°ç­¾å<br><code>codesign --deep -f -s &quot;Mac Developer: purkylin@gmail.com (K2WB492RBL)&quot; &lt;App&gt;</code></li>
<li>æŸ¥çœ‹ç­¾å<br><code>codesign -d --verbose=3 &lt;App&gt;</code></li>
<li>æŸ¥çœ‹dylibåç§»<br><code>image list -o</code></li>
<li>ä¸­æ–‡å­—ç¬¦ä¸²æŸ¥æ‰¾<br>åœ¨å­—ç¬¦ä¸²èµ„æºæ–‡ä»¶é‡ŒæŸ¥æ‰¾å¯¹åº”çš„è‹±æ–‡æ¡ç›®ï¼Œç„¶åæ”¾åˆ°hopperé‡ŒæŸ¥æ‰¾å³å¯</li>
<li><strong>ASLR</strong>: Address space layout random</li>
<li><strong>SIP</strong>: system integrity protection<br>  åœ¨ OS X El Capitan ä¸­æœ‰ä¸€ä¸ªè·Ÿå®‰å…¨ç›¸å…³çš„æ¨¡å¼å« SIPï¼ˆSystem Integrity Protection ï¼‰ï¼Œå®ƒç¦æ­¢è®©è½¯ä»¶ä»¥ root èº«ä»½æ¥åœ¨ Mac ä¸Šè¿è¡Œï¼Œåœ¨å‡çº§åˆ° OS X 10.11 ä¸­æˆ–è®¸ä½ å°±ä¼šçœ‹åˆ°éƒ¨åˆ†åº”ç”¨ç¨‹åºè¢«ç¦ç”¨äº†ï¼Œè¿™äº›æˆ–è®¸æ˜¯ä½ é€šè¿‡ç»ˆç«¯æˆ–è€…ç¬¬ä¸‰æ–¹è½¯ä»¶æºå®‰è£…ã€‚å¯¹äºå¤§å¤šæ•°ç”¨æˆ·æ¥è¯´ï¼Œè¿™ç§å®‰å…¨è®¾ç½®å¾ˆæ–¹ä¾¿ï¼Œä½†æ˜¯ä¹Ÿæœ‰äº›å¼€å‘è€…æˆ–è€…é«˜çº§ Mac ç”¨æˆ·ä¸éœ€è¦è¿™æ ·çš„è®¾ç½®ã€‚<pre><code>1. é‡å¯ Macï¼ŒæŒ‰ä½Command+Ré”®ç›´åˆ°Apple logo å‡ºç°ï¼Œè¿›å…¥Recovery Mode
2. ç‚¹å‡» Utilities &gt; Terminal, åœ¨ Terminalä¸­è¾“å…¥`csrutil disable`ï¼Œä¹‹åå›è½¦
</code></pre>  é‡å¯ Mac,è¿™æ ·SIPå®‰å…¨è®¾ç½®å°±å·²ç»è¢«å…³é—­äº†ï¼Œå¦‚æœæƒ³é‡æ–°å¼€å¯è¯¥å®‰å…¨è®¾ç½®ï¼Œé‡å¤ä¸Šé¢æ­¥éª¤ï¼Œåœ¨ç¬¬ä¸‰æ­¥ä¸­å°†å‘½ä»¤æ›´æ¢ä¸º <code>csrutil enable</code>ã€‚<br>å¸¸ç”¨çš„å‘½ä»¤å¦‚ä¸‹ï¼š  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo csrutil enable &#8211;without fs&#65306;Filesystem Protections disable&#10;sudo csrutil enable &#8211;without kext&#65306;Kext Signing disable&#10;sudo csrutil enable &#8211;without debug&#65306;Debugging Restrictions disable&#10;sudo csrutil enable &#8211;without nvram&#65306;NVRAM Protections disable&#10;sudo csrutil enable &#8211;without dtrace&#65306;DTrace Restrictions disable</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>å…¶ä¸­ <strong>kext signing</strong> è¡¨ç¤ºè‹¹æœè®¤è¯çš„ssid</p>
<ul>
<li><p>å®‰å…¨æ¨¡å¼å¯åŠ¨<br>è¯·æ‰§è¡Œä»¥ä¸‹æ­¥éª¤ä»¥å¯åŠ¨è¿›å…¥å®‰å…¨æ¨¡å¼ã€‚å¯åŠ¨æˆ–é‡æ–°å¯åŠ¨ Macã€‚å¬åˆ°å¯åŠ¨å£°åï¼Œç«‹å³æŒ‰ä½ Shift é”®ã€‚<br>çœ‹åˆ°å±å¹•ä¸Šå‡ºç° Apple æ ‡å¿—åæ¾å¼€Shifté”®<br>æ¢å¤æ¨¡å¼å¯åŠ¨<br>æ¢å¤æ¨¡å¼çš„å…·ä½“æ“ä½œæ˜¯ï¼šå¼€æœºæ—¶æŒ‰ä½é”®ç›˜ä¸Šçš„â€œOptionâ€é”®ï¼Œåœ¨å¼€æœºé€‰æ‹©èœå•ä¸­é€‰æ‹©<em>Recovery HD</em>å³å¯</p>
</li>
<li><p>ptrace åè°ƒè¯•<br>ä¸‹é¢çš„å‘½ä»¤å¯ä»¥åè°ƒè¯•ï¼Œ å¦‚æœè°ƒç”¨ä¸€æ¬¡å¾ˆå®¹æ˜“è¢«hackæ‰<br><code>ptrace(PT_DENY_ATTACH, 0, 0, 0);</code><br>æŠŠä¸Šé¢å‘½ä»¤ä¸­çš„<strong>PT_DENY_ATTACH</strong>æ›¿æ¢æˆ<strong>0x0a</strong>å³å¯å…è®¸è°ƒè¯•</p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#define PT_TRACE_ME 0 /* child declares it&#39;s being traced */&#10;#define PT_READ_I 1 /* read word in child&#39;s I space */&#10;#define PT_READ_D 2 /* read word in child&#39;s D space */&#10;#define PT_READ_U 3 /* read word in child&#39;s user structure */&#10;#define PT_WRITE_I 4 /* write word in child&#39;s I space */&#10;#define PT_WRITE_D 5 /* write word in child&#39;s D space */&#10;#define PT_WRITE_U 6 /* write word in child&#39;s user structure */&#10;#define PT_CONTINUE 7 /* continue the child */&#10;#define PT_KILL 8 /* kill the child process */&#10;#define PT_STEP 9 /* single step the child */&#10;#define PT_ATTACH 10 /* trace some running process */&#10;#define PT_DETACH 11 /* stop tracing a process */&#10;#define PT_SIGEXC 12 /* signals as exceptions for current_proc */&#10;#define PT_THUPDATE 13 /* signal for thread# */&#10;#define PT_ATTACHEXC 14 /* attach to running process with signal exception */&#10;&#10;#define PT_FORCEQUOTA 30 /* Enforce quota for root */&#10;#define PT_DENY_ATTACH 31</span><br></pre></td></tr></table></figure>
<ul>
<li><p>è°ƒç”¨çº¦å®š<strong>ABI</strong><br><a href="http://people.freebsd.org/~obrien/amd64-elf-abi.pdf" target="_blank" rel="external">å‚è€ƒ</a></p>
<ol>
<li>ä¼ å‚<br>If the class is MEMORY, pass the argument on the stack.</li>
<li>If the class is INTEGER, the next available register of the sequence %rdi,<br>%rsi, %rdx, %rcx, %r8 and %r9 is used12 .</li>
<li>If the class is SSE, the next available SSE register is used, the registers are<br>taken in the order from %xmm0 to %xmm7.</li>
<li>If the class is SSEUP, the eightbyte is passed in the upper half of the least<br>used SSE register.</li>
<li><p>If the class is X87, X87UP or COMPLEX_X87, it is passed in memory.</p>
<p>Note that %r11 is neither required to be preserved, nor is it used to pass arguments. Making this register available as scratch register means that code in the PLT need not spill any registers when computing the address to which control needs to be transferred. %rax is used to indicate the number of SSE arguments passed to a function requiring a variable number of arguments. %r10 is used for passing a functionâ€™s static chain pointer.</p>
</li>
</ol>
</li>
</ul>
<h2 id="å·¥å…·ï¼š"><a href="#å·¥å…·ï¼š" class="headerlink" title="å·¥å…·ï¼š"></a>å·¥å…·ï¼š</h2><ul>
<li>Hopper åæ±‡ç¼–å·¥å…·</li>
<li>MachxView æŸ¥çœ‹åº”ç”¨ä¿¡æ¯</li>
<li>Interface Inspector æŸ¥çœ‹è§†å›¾ç»“æ„</li>
<li>class-dump è¾“å‡ºç±»ä¿¡æ¯</li>
</ul>
<h2 id="å®æˆ˜ç¯‡"><a href="#å®æˆ˜ç¯‡" class="headerlink" title="å®æˆ˜ç¯‡"></a>å®æˆ˜ç¯‡</h2><h3 id="iPic-v1-2ç ´è§£"><a href="#iPic-v1-2ç ´è§£" class="headerlink" title="iPic v1.2ç ´è§£"></a>iPic v1.2ç ´è§£</h3><ol>
<li>æŸ¥æ‰¾å‡½æ•°<strong>sub_10008e</strong>ï¼ŒæŠŠ<code>000000010008ee66         je         0x10008ee97</code> è¿™ä¸€è¡Œæ”¹ä¸º nop</li>
<li>æŸ¥æ‰¾å‡½æ•°<strong> sub_1001036b0</strong>ï¼Œç›´æ¥è¿”å›1</li>
<li>é‡æ–°ç­¾å</li>
</ol>
<h3 id="Reveal2-ç ´è§£"><a href="#Reveal2-ç ´è§£" class="headerlink" title="Reveal2 ç ´è§£"></a>Reveal2 ç ´è§£</h3><ol>
<li>ç»•è¿‡ptraceåè°ƒè¯•</li>
<li>ç»•è¿‡å®Œæ•´æ€§æ£€æŸ¥ï¼Œ è®©å‡½æ•°<strong>sub_1001ecbc0</strong>è¿”å›1å³å¯</li>
<li>ç»•è¿‡å¯åŠ¨æ—¶å¼¹çª—ï¼Œreveal2ä½¿ç”¨çš„æ˜¯swfité‡å†™çš„ï¼Œè¯ä¹¦ç®¡ç†ä½¿ç”¨çš„æ˜¯devmateåº“ï¼Œ<br>ä¸€èˆ¬å¯åŠ¨ä»£ç å¦‚ä¸‹ï¼š</li>
</ol>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">if (!DMKIsApplicationActivated(NULL))&#10;&#123;&#10;    [DevMateKit runActivationDialog:nil inMode:DMActivationModeModal];&#10;    if (!DMKIsApplicationActivated(NULL))&#10;    &#123;&#10;        [NSApp terminate:nil];&#10;    &#125;&#10;&#125;</span><br></pre></td></tr></table></figure>
<p>æˆ‘å¼‚æƒ³å¤©å¼€å¦‚æœä¿®æ”¹è¿™ä¸ªåº“ï¼Œè®©è¿™ä¸ªå‡½æ•°<strong>DMKIsApplicationActivated</strong>è¿”å›1<br>å³å¯ï¼Œä¸çŸ¥æ˜¯å¦å¯è¡Œï¼Œæˆ‘åªæ˜¯æ”¹äº†framework,æœªæ”¹ç­¾åï¼Œå‘ç°è¿è¡Œå‡ºé”™ï¼Œä¸çŸ¥æ˜¯å¦å¯è¡Œï¼Œæœ‰å¾…æµ‹è¯•ã€‚</p>
<p>æ‰¾åˆ°è¿™ä¸ªå‡½æ•°<strong>sub_1000d5c80</strong>ï¼Œåè½¬ç¬¬ä¸€ä¸ªifå³å¯ç»•è¿‡å¼¹å‡º</p>
<ol>
<li>enableèœå•</li>
<li>ä»¥invalidMenuä¸ºå…³é”®å­—æŸ¥æ‰¾ï¼Œåœ¨é€‚å½“çš„ä½ç½®åè½¬æ¡ä»¶å³å¯ã€‚åªæ˜¯æœ‰éƒ¨åˆ†èœå•ä¸èƒ½enable,å¦‚file/new windowï¼Œ ä¸çŸ¥ä¸ºä»€ä¹ˆï¼Œæœ‰å¾…è§£å†³</li>
<li><h3 id="Reveal6-ç ´è§£"><a href="#Reveal6-ç ´è§£" class="headerlink" title="Reveal6 ç ´è§£"></a>Reveal6 ç ´è§£</h3>ç›¸å¯¹Reveal2ï¼Œ Reveal6ç ´è§£éš¾åº¦å¢åŠ ä¸å°‘ï¼Œè®©äººæ‘¸ä¸åˆ°å¤´è„‘</li>
<li>é¦–å…ˆç¦ç”¨åè°ƒè¯•ï¼Œ è€ç”Ÿå¸¸è°ˆï¼Œæ‰¾Entry Point,è·³åˆ°è¿™ä¸ªåœ°å€000000010028d50cï¼Œ æ‰¾åˆ°ptraceè¯­å¥ï¼ŒæŠŠå®ƒç¬¬ä¸€ä¸ªå‚æ•°æ›¿æ¢ä¸º0x0a</li>
<li>éšè—å¼¹çª—ï¼Œè¿™ä¸€æ­¥èŠ±è´¹äº†å¾ˆé•¿æ—¶é—´ï¼Œæœ€åå®åœ¨æ²¡æ–¹æ³•ï¼Œæ—¢ç„¶æ˜¯å¼¹çª—ï¼Œä¸€å®šä¼šè°ƒç”¨runModelå‡½æ•°ï¼Œæœç´¢runModelæ‰¾åˆ°æ–¹æ³•ï¼Œæ¥åˆ°è¿™ä¸ªåœ°å€000000010003a460ï¼Œè®©è¿™ä¸ªå‡½æ•°ç›´æ¥è¿”å›1å³å¯ï¼Œç„¶åç»§ç»­æ‰§è¡Œä¼šè°ƒç”¨00000001002b00e4è¿™ä¸ªå‡½æ•°è®©å®ƒè¿”å›0.</li>
<li>ç­¾åä¸è§£é‡Š</li>
<li>ç­¾å®Œååè¿è¡Œä¼šå‡ºç°â€œThis copy of Reveal is damagedâ€å¯¹è¯æ¡†ã€‚æœç´¢â€œDamagedâ€ï¼Œä¼šå‘ç°â€Application Damaged Alertâ€œï¼Œè·Ÿè¿›è¿™ä¸ªå‡½æ•°ï¼ˆ0000000100161d30ï¼‰ç›´æ¥è¿”å›å³å¯ã€‚</li>
<li>å†æ¬¡é‡æ–°ç­¾åï¼ŒğŸ‘Œ</li>
<li>èœå•ç°è‰²ä»¥åå†å¼„</li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://purkylin.github.io/2017/02/22/macosé€†å‘ç¬”è®°/" data-id="cizgffwi10001t63ohlpco625" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
    
<nav id="article-nav">
  
  
    <a href="/2017/02/22/CMDeviceâ€‹Motionå­¦ä¹ ç¬”è®°/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">CMDeviceâ€‹Motionå­¦ä¹ ç¬”è®°</div>
    </a>
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    

  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">å½’æ¡£</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/02/">äºŒæœˆ 2017</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">æœ€æ–°æ–‡ç« </h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2017/02/22/macosé€†å‘ç¬”è®°/">macosé€†å‘ç¬”è®°</a>
          </li>
        
          <li>
            <a href="/2017/02/22/CMDeviceâ€‹Motionå­¦ä¹ ç¬”è®°/">CMDeviceâ€‹Motionå­¦ä¹ ç¬”è®°</a>
          </li>
        
          <li>
            <a href="/2017/02/22/macOSç¼–ç¨‹/">macOSç¼–ç¨‹</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2017 Purkylin<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css" type="text/css">
  <script src="/fancybox/jquery.fancybox.pack.js" type="text/javascript"></script>


<script src="/js/script.js" type="text/javascript"></script>

  </div>
</body>
</html>